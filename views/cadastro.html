<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Cascadia+Mono&display=swap" rel="stylesheet" />
    <link href="..\static\css\cadastro.css" rel="stylesheet" />
    <link rel="icon" href="..\static\css\images\logo.png" type="image/x-icon">
</head>
<title>MyCommiserate</title>

<body>
    <div class="v74_2">
        <div class="v74_3"></div><span class="v74_4">Usuário:</span><span class="v74_7">Senha:
        </span><span class="v74_14">Conf. Senha:</span>
        <input class="v74_8" id="usuario"></input>
        <input class="v74_9" id="senha"></input>
        <input class="v74_15" id="senhaconfirmada"></input>
        <center>
            <div class="v74_10"></div>
        </center>
        <div class="v74_18"></div>
        <button class="v74_19">Confirmar</button>
    </div>

    <script>
        document.querySelector(".v74_19").addEventListener("click", async () => {
            const username = document.querySelector("#usuario").value;
            const password = document.querySelector("#senha").value;
            const passwordconfirmed = document.querySelector("#senhaconfirmada").value;

            if (password !== passwordconfirmed) {
                alert("Confirmação da senha e senha estão diferentes.");
                return; // Encerra a função caso as senhas não sejam iguais
            }

            const response = await fetch("/users", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();

            if (data.message === "Usuário criado com sucesso!") {
                // Armazena o usuário logado no localStorage
                const responseUser = await fetch(`/users/usuario/${username}`);
                const dataUser = await responseUser.json();

                if (responseUser.status === 404) {
                    alert("Usuário não encontrado");
                } else {
                    // Armazena o ID do usuário logado no localStorage
                    localStorage.setItem("loggedInUserID", dataUser.id);
                    window.location.href = "index.html";
                }
                alert("Cadastro feito");
            } else {
                alert("Dados incorretos");
            }
        });
    </script>

</body>

</html>
