<!DOCTYPE html>
<html>

<head>
    <link href="..\static\css\cadastro.css" rel="stylesheet" />
    <link rel="icon" href="..\static\images\logo.png" type="image/x-icon">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8291700047790609"
     crossorigin="anonymous"></script>

</head>
<title>MyCommiserate</title>

<body>
    <div class="logoContainer">
        <img src="../static/images/v23_33.png" onclick="window.location.href='/'" alt="logo"> 
    </div>

    <div class="formContainer">
        <div class="userContainer">
          <label for="usuario">Usuário:</label> <br />
          <input type="text" class="userInput" id="usuario" /> <br />
        </div>
        <div class="passwdContainer">
            <label for="senha">Senha:</label> <br />
            <input type="password" class="passwdInput" id="senha" />
          </div>
        <div class="cpasswdContainer">
          <label for="senha">Conf. Senha:</label> <br />
          <input type="password" class="cpasswdInput" id="senhaconfirmada" />
        </div>
    </div>

    <div class="btnContainer">
        <button class="btn" id="cadastrar">Cadastrar</button>
      </div>

    <script>
        document.querySelector("#cadastrar").addEventListener("click", async () => {
            const username = document.querySelector("#usuario").value;
            const password = document.querySelector("#senha").value;
            const passwordconfirmed = document.querySelector("#senhaconfirmada").value;

            if (password !== passwordconfirmed) {
                alert("Confirmação da senha e senha estão diferentes.");
                return; // Encerra a função caso as senhas não sejam iguais
            }

            const response = await fetch("/user", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();

            if (data.message === "Usuário criado com sucesso!") {
                // Armazena o usuário logado no localStorage
                const responseUser = await fetch(`/users/usuario/${username}`);
                const dataUser = await responseUser.json();

                if (responseUser.status === 404) {
                    alert("Usuário não encontrado");
                } else {
                    // Armazena o ID do usuário logado no localStorage
                    localStorage.setItem("loggedInUserID", dataUser.id);
                    window.location.href = "/";
                }
                alert("Cadastro feito");
            } else {
                alert("Dados incorretos");
            }
        });
    </script>

</body>

</html>
